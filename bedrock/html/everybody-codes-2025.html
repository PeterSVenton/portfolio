<h1>Everybody Codes 2025</h1>
<h2>What is Everybody Codes?</h2>
<p><strong>Everybody Codes</strong> is a yearly community-driven coding event built around a collection of puzzles, logic challenges, and programming tasks. It’s designed to be inclusive and welcoming — whether you’re a seasoned developer or brand-new to coding.</p>
<p>Across the event, participants solve progressively more interesting problems that stretch skills in <strong>data structures, algorithms, simulation, parsing, and creative problem-solving</strong>. It’s collaborative, fun, and a great way to learn by doing.</p>
<p>At its core, Everybody Codes celebrates one idea:<br>
<strong>anyone can code — and everyone can get better at it.</strong></p>
<hr>
<h2>Why This Article?</h2>
<p>Originally, I planned to write a full walkthrough of every single problem.<br>
But after completing the event, I realised something: not every puzzle needs a long explanation — and not every solution is equally interesting.</p>
<p>Instead, this article focuses on the <strong>most notable, tricky, or clever problems</strong> from Everybody Codes 2025 — the ones where I learned something new, had an “aha!” moment, or discovered a surprisingly elegant solution.</p>
<p>For each selected problem, I’ll walk through:</p>
<ul>
<li><strong>How I approached the puzzle</strong></li>
<li><strong>The reasoning behind my solution</strong></li>
<li><strong>Challenges or dead ends I ran into</strong></li>
<li><strong>The final implementation</strong></li>
</ul>
<p>The goal is not just to show answers, but to explain the <em>thinking</em> behind them — what worked, what didn’t, and how each puzzle revealed a new pattern or technique worth remembering.</p>
<hr>
<h2>Before We Dive In</h2>
<p>Some recurring themes showed up across the challenges:</p>
<ul>
<li><strong>Input parsing</strong>: Many puzzles use compact or ambiguous input formats that require careful preprocessing.</li>
<li><strong>Stateful iteration</strong>: Several tasks involve step-by-step simulation or maintaining evolving state.</li>
<li><strong>Mathematical tricks</strong>: Modulo arithmetic, boundary handling, and index mapping appear often.</li>
<li><strong>Data transformation</strong>: Turning raw text into structured, usable data is half the work.</li>
</ul>
<p>To keep this article clean and focused, I’ll skip the simpler warmups and concentrate only on the puzzles that were particularly fun, unexpected, or thought-provoking.</p>
<hr>
<h1>Quest 8 – String Art and Intersecting Lines</h1>
<p>This quest turns away from dragonducks, DNA chains, and magical tournaments, and heads into something surprisingly mathematical and artistic: circular string-art. The aesthetic is simple — nails evenly spaced around a circle, connected with a long thread — but beneath the surface lies geometry, combinatorics, and a lot more structure than you might expect.</p>
<p>The puzzle is divided into three escalating challenges:</p>
<ol>
<li>Count how many thread segments pass through the exact centre of the circle.</li>
<li>Count how many segment–segment intersections occur (how many knotted crossings an artist would need to tie).</li>
<li>Find the strongest sword strike — the straight line between two nails that slices through the greatest number of threads.</li>
</ol>
<p>My final answers were:</p>
<ul>
<li>Part 1: 57</li>
<li>Part 2: 2,927,416</li>
<li>Part 3: 2800</li>
</ul>
<p>To solve it, I ended up building a full geometric engine: mapping nails to Cartesian coordinates, converting segments to line equations, and analytically computing intersections. It’s a bit overkill for a puzzle that secretly has very elegant circle-geometry shortcuts — but I solved this at 11 PM, half-asleep, and didn’t notice the nicer methods until the next morning.</p>
<p>Sometimes the scenic route is the memorable route.</p>
<hr>
<h2>Representing Nails on the Unit Circle</h2>
<p>Every part of the puzzle is ultimately about segments between pairs of nails. So the first step is to represent each nail as a point in 2D space.</p>
<p>I mapped each nail index to a point on the unit circle, rotated such that nail 1 sits at the top:</p>
<pre><code class="language-python">from math import sin, cos, pi

def build_coordinates(nails):
    final = {}
    angle_increment = 1 / nails
    for i in range(nails):
        y = cos(2 * pi * (i * angle_increment))
        x = sin(2 * pi * (i * angle_increment))
        final[i + 1] = (x, y)
    return final
</code></pre>
<p><img src="/md-media/everybody-codes-2025/nail-circle.png" alt="Image of nail circle"></p>
<hr>
<h2>Part I – Counting Centre Crossings</h2>
<p>Given a sequence of nails, how many thread segments pass exactly through the centre?</p>
<p>On an even-nail circle, a segment hits the centre iff it connects opposite nails:</p>
<pre><code class="language-python">from itertools import pairwise

def part1(inp, nails):
    semi = nails // 2
    result = 0
    for n1, n2 in pairwise(inp):
        if abs(n2 - n1) == semi:
            result += 1
    return result
</code></pre>
<p>My final answer for Part I: 57</p>
<hr>
<h2>Turning Segments into Line Equations</h2>
<p>To detect intersections (Parts II and III), I converted every thread segment into its corresponding line equation:</p>
<pre><code class="language-python">def get_line_info(p1, p2, coords):
    x1, y1 = coords[p1]
    x2, y2 = coords[p2]

    if abs(x2 - x1) &#x3C; 1e-9:
        return None, None, x2  # vertical line

    slope = (y2 - y1) / (x2 - x1)
    b = y1 - slope * x1
    return slope, b, None
</code></pre>
<p>And a helper to test whether an intersection point lies strictly inside the circle:</p>
<pre><code class="language-python">from math import sqrt

def is_in_unit_circle(x, y):
    epsilon = 0.00001
    magnitude = sqrt(x*x + y*y)
    return (-1 + epsilon) &#x3C; magnitude &#x3C; (1 - epsilon)
</code></pre>
<hr>
<h2>Part II – Counting Knots (Segment Intersections)</h2>
<p>The problem states:</p>
<ul>
<li>Every crossing of two segments requires a knot.</li>
<li>If several intersections lie at the same location, each is still a separate knot.</li>
</ul>
<p>So: count all segment–segment intersections inside the circle.</p>
<p>Intersection logic:</p>
<pre><code class="language-python">def does_intersect(l1, l2):
    slope1, b1, v1 = l1
    slope2, b2, v2 = l2

    if v1 is not None and v2 is not None and v1 != v2:
        return False
    if l1 == l2:
        return True

    if v1 is not None:
        x = v1
    elif v2 is not None:
        x = v2
    elif abs(slope1 - slope2) &#x3C; 1e-9:
        return False
    else:
        x = -(b2 - b1) / (slope2 - slope1)

    if v1 is not None:
        y = slope2 * x + b2
    else:
        y = slope1 * x + b1

    return is_in_unit_circle(x, y)
</code></pre>
<p>Count all intersections:</p>
<pre><code class="language-python">def get_intersections(lines):
    result = 0
    for i, l1 in enumerate(lines):
        for l2 in lines[:i]:
            if does_intersect(l1, l2):
                result += 1
    return result
</code></pre>
<p>Wrapper:</p>
<pre><code class="language-python">def part2(inp, nails):
    coords = build_coordinates(nails)
    lines = []
    for n1, n2 in pairwise(inp):
        lines.append(get_line_info(n1, n2, coords))
    return get_intersections(lines)
</code></pre>
<p>My total knot count for Part II: <strong>2,927,416</strong></p>
<hr>
<h2>Part III – The Best Sword Strike</h2>
<p>A magical sword strike is simply a straight line between two nails.</p>
<p>The strike:</p>
<ul>
<li>cuts every thread it intersects</li>
<li>also cuts a thread if the thread lies exactly between those two nails</li>
<li>must choose the best pair of nails for maximum intersections</li>
</ul>
<p>I reused the same geometric machinery.</p>
<p>Count intersections for a strike:</p>
<pre><code class="language-python">def part3_intersections(tup, lines, coords):
    l_start, l_end = tup
    baseline = get_line_info(l_start, l_end, coords)
    count = 0
    for line in lines:
        if does_intersect(baseline, line):
            count += 1
    return count
</code></pre>
<p>Check all nail pairs:</p>
<pre><code class="language-python">def part3(inp, nails):
    coords = build_coordinates(nails)
    lines = [get_line_info(a, b, coords) for a, b in pairwise(inp)]
    best = 0

    for i in range(1, nails+1):
        for j in range(i+2, nails+1):
            best = max(best, part3_intersections((i, j), lines, coords))

    return best
</code></pre>
<p>My result: <strong>2800</strong> threads cut by the optimal strike.</p>
<p>A conceptual diagram of the search:</p>
<svg id="mermaid-0" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="flowchart" style="max-width: 276px;" viewBox="0 0 276 406" role="graphics-document document" aria-roledescription="flowchart-v2"><style>#mermaid-0{font-family:arial,sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-0 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-0 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-0 .error-icon{fill:#552222;}#mermaid-0 .error-text{fill:#552222;stroke:#552222;}#mermaid-0 .edge-thickness-normal{stroke-width:1px;}#mermaid-0 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-0 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-0 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-0 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-0 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-0 .marker{fill:#333333;stroke:#333333;}#mermaid-0 .marker.cross{stroke:#333333;}#mermaid-0 svg{font-family:arial,sans-serif;font-size:16px;}#mermaid-0 p{margin:0;}#mermaid-0 .label{font-family:arial,sans-serif;color:#333;}#mermaid-0 .cluster-label text{fill:#333;}#mermaid-0 .cluster-label span{color:#333;}#mermaid-0 .cluster-label span p{background-color:transparent;}#mermaid-0 .label text,#mermaid-0 span{fill:#333;color:#333;}#mermaid-0 .node rect,#mermaid-0 .node circle,#mermaid-0 .node ellipse,#mermaid-0 .node polygon,#mermaid-0 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-0 .rough-node .label text,#mermaid-0 .node .label text,#mermaid-0 .image-shape .label,#mermaid-0 .icon-shape .label{text-anchor:middle;}#mermaid-0 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-0 .rough-node .label,#mermaid-0 .node .label,#mermaid-0 .image-shape .label,#mermaid-0 .icon-shape .label{text-align:center;}#mermaid-0 .node.clickable{cursor:pointer;}#mermaid-0 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mermaid-0 .arrowheadPath{fill:#333333;}#mermaid-0 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-0 .flowchart-link{stroke:#333333;fill:none;}#mermaid-0 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-0 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mermaid-0 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-0 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-0 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-0 .cluster text{fill:#333;}#mermaid-0 .cluster span{color:#333;}#mermaid-0 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-0 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-0 rect.text{fill:none;stroke-width:0;}#mermaid-0 .icon-shape,#mermaid-0 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-0 .icon-shape p,#mermaid-0 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mermaid-0 .icon-shape rect,#mermaid-0 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-0 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-0 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-0 :root{--mermaid-font-family:arial,sans-serif;}</style><g><marker id="mermaid-0_flowchart-v2-pointEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-0_flowchart-v2-pointStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="4.5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-0_flowchart-v2-circleEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-0_flowchart-v2-circleStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-0_flowchart-v2-crossEnd" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-0_flowchart-v2-crossStart" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path d="M138,62L138,66.167C138,70.333,138,78.667,138,86.333C138,94,138,101,138,104.5L138,108" id="L_A_B_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_A_B_0" data-points="W3sieCI6MTM4LCJ5Ijo2Mn0seyJ4IjoxMzgsInkiOjg3fSx7IngiOjEzOCwieSI6MTEyfV0=" marker-end="url(#mermaid-0_flowchart-v2-pointEnd)"></path><path d="M138,166L138,170.167C138,174.333,138,182.667,138,190.333C138,198,138,205,138,208.5L138,212" id="L_B_C_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_B_C_0" data-points="W3sieCI6MTM4LCJ5IjoxNjZ9LHsieCI6MTM4LCJ5IjoxOTF9LHsieCI6MTM4LCJ5IjoyMTZ9XQ==" marker-end="url(#mermaid-0_flowchart-v2-pointEnd)"></path><path d="M138,294L138,298.167C138,302.333,138,310.667,138,318.333C138,326,138,333,138,336.5L138,340" id="L_C_D_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_C_D_0" data-points="W3sieCI6MTM4LCJ5IjoyOTR9LHsieCI6MTM4LCJ5IjozMTl9LHsieCI6MTM4LCJ5IjozNDR9XQ==" marker-end="url(#mermaid-0_flowchart-v2-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" data-id="L_A_B_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_B_C_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_C_D_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default" id="flowchart-A-0" transform="translate(138, 35)"><rect class="basic label-container" style="" x="-101.140625" y="-27" width="202.28125" height="54"></rect><g class="label" style="" transform="translate(-71.140625, -12)"><rect></rect><foreignObject width="142.28125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Choose nail pair (i,j)</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-B-1" transform="translate(138, 139)"><rect class="basic label-container" style="" x="-94.4609375" y="-27" width="188.921875" height="54"></rect><g class="label" style="" transform="translate(-64.4609375, -12)"><rect></rect><foreignObject width="128.921875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Form sword chord</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-C-3" transform="translate(138, 255)"><rect class="basic label-container" style="" x="-130" y="-39" width="260" height="78"></rect><g class="label" style="" transform="translate(-100, -24)"><rect></rect><foreignObject width="200" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;"><span class="nodeLabel"><p>Count intersections with all segments</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-D-5" transform="translate(138, 371)"><rect class="basic label-container" style="" x="-88.8359375" y="-27" width="177.671875" height="54"></rect><g class="label" style="" transform="translate(-58.8359375, -12)"><rect></rect><foreignObject width="117.671875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Track best result</p></span></div></foreignObject></g></g></g></g></g></svg>
<hr>
<h2>A Slightly Overengineered Solution</h2>
<p>The funny part of this quest is that there is a much simpler way to handle intersections on a circle: for a chord between two nails, another chord intersects it if and only if one endpoint lies between them (in clockwise order) and the other lies outside that arc.</p>
<p>Instead of using that insight, I mapped everything to <code>(x, y)</code> coordinates on the unit circle and did full line–line intersection tests, including special cases for vertical lines and numerical epsilon checks for being inside the circle.</p>
<p>Was it necessary? No. Was it fun? Absolutely.</p>
<p>This quest ended up being a nice mix of:</p>
<ul>
<li>circular geometry</li>
<li>line equations and intersections</li>
<li>brute force over segment pairs</li>
<li>and a reminder that sometimes the “ridiculous” solution is still fast enough to be interesting.</li>
</ul>
<h1>Quest 9 – Encoded in the Scales</h1>
<p>This was one of my favourite challenges in Everybody Codes 2025. The entire puzzle revolves around inferring dragonduck family relationships purely from their DNA sequences.</p>
<p>Each DNA string is made from four symbols: <code>A</code>, <code>T</code>, <code>C</code>, <code>G</code>. The rules of inheritance are simple but surprisingly powerful:</p>
<blockquote>
<p>At each index in the DNA sequence, a child’s symbol must match one of the two parents’ symbols at that position.</p>
</blockquote>
<p>From that rule, the puzzle asks us to figure out which scales represent children, which ones represent parents, which parent pairs belong together, how the dragons form families, and even which family is the largest.</p>
<hr>
<h2>The Core Idea: Let the DNA Tell Us Who the Parents Are</h2>
<p>A straightforward but inefficient approach would be to guess which sequences are children, then try to match them to parent pairs. Instead, I flipped the problem around:</p>
<blockquote>
<p>Assume every sequence <em>might</em> be a child, then see which parent pairs could have produced it.</p>
</blockquote>
<p>If there exists exactly one parent pair capable of producing that sequence, then it must be a child. If no such pair exists, the sequence must be a parent.</p>
<p>This perspective makes the whole problem fall neatly into place.</p>
<hr>
<h2>Building the Possibility Tree</h2>
<p>For a candidate child and a potential parent pair <code>(p1, p2)</code>, every index in the DNA has to pass a simple test:</p>
<ul>
<li>if the child’s symbol matches either parent, this parent pair is still possible</li>
<li>if it doesn’t, the pair is impossible and can be discarded immediately</li>
</ul>
<p>This leads to what I call the <strong>possibility tree</strong>. For every valid match at position <code>i</code>, I record that the parent pair is possible for <code>(i, child[i])</code>.</p>
<p>Here is the function that constructs that mapping:</p>
<pre><code class="language-python">def _possibility_tree(n1, n2, p1, p2, child_seq):
    result = {}
    for i, (c1, c2, child_c) in enumerate(zip(p1, p2, child_seq)):
        if child_c not in (c1, c2):
            return {}
        result[(i, c1)] = (n1, n2)
        result[(i, c2)] = (n1, n2)
    return result
</code></pre>
<p>If you visualise the logic, each index is processed like this:</p>
<svg id="mermaid-1" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="flowchart" style="max-width: 1152.5px;" viewBox="0 0 1152.5 294" role="graphics-document document" aria-roledescription="flowchart-v2"><style>#mermaid-1{font-family:arial,sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-1 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-1 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-1 .error-icon{fill:#552222;}#mermaid-1 .error-text{fill:#552222;stroke:#552222;}#mermaid-1 .edge-thickness-normal{stroke-width:1px;}#mermaid-1 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-1 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1 .marker{fill:#333333;stroke:#333333;}#mermaid-1 .marker.cross{stroke:#333333;}#mermaid-1 svg{font-family:arial,sans-serif;font-size:16px;}#mermaid-1 p{margin:0;}#mermaid-1 .label{font-family:arial,sans-serif;color:#333;}#mermaid-1 .cluster-label text{fill:#333;}#mermaid-1 .cluster-label span{color:#333;}#mermaid-1 .cluster-label span p{background-color:transparent;}#mermaid-1 .label text,#mermaid-1 span{fill:#333;color:#333;}#mermaid-1 .node rect,#mermaid-1 .node circle,#mermaid-1 .node ellipse,#mermaid-1 .node polygon,#mermaid-1 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1 .rough-node .label text,#mermaid-1 .node .label text,#mermaid-1 .image-shape .label,#mermaid-1 .icon-shape .label{text-anchor:middle;}#mermaid-1 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-1 .rough-node .label,#mermaid-1 .node .label,#mermaid-1 .image-shape .label,#mermaid-1 .icon-shape .label{text-align:center;}#mermaid-1 .node.clickable{cursor:pointer;}#mermaid-1 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mermaid-1 .arrowheadPath{fill:#333333;}#mermaid-1 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-1 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-1 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mermaid-1 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-1 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-1 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1 .cluster text{fill:#333;}#mermaid-1 .cluster span{color:#333;}#mermaid-1 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-1 rect.text{fill:none;stroke-width:0;}#mermaid-1 .icon-shape,#mermaid-1 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-1 .icon-shape p,#mermaid-1 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mermaid-1 .icon-shape rect,#mermaid-1 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-1 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-1 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-1 :root{--mermaid-font-family:arial,sans-serif;}</style><g><marker id="mermaid-1_flowchart-v2-pointEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-1_flowchart-v2-pointStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="4.5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-1_flowchart-v2-circleEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-1_flowchart-v2-circleStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-1_flowchart-v2-crossEnd" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-1_flowchart-v2-crossStart" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path d="M211.172,147L215.339,147C219.505,147,227.839,147,235.505,147C243.172,147,250.172,147,253.672,147L257.172,147" id="L_A_B_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_A_B_0" data-points="W3sieCI6MjExLjE3MTg3NSwieSI6MTQ3fSx7IngiOjIzNi4xNzE4NzUsInkiOjE0N30seyJ4IjoyNjEuMTcxODc1LCJ5IjoxNDd9XQ==" marker-end="url(#mermaid-1_flowchart-v2-pointEnd)"></path><path d="M504.873,112.702L516.932,108.751C528.991,104.801,553.109,96.901,574.319,92.95C595.529,89,613.831,89,622.982,89L632.133,89" id="L_B_C_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_B_C_0" data-points="W3sieCI6NTA0Ljg3MzQ3MzY5NzExMTcsInkiOjExMi43MDE1OTg2OTcxMTE3fSx7IngiOjU3Ny4yMjY1NjI1LCJ5Ijo4OX0seyJ4Ijo2MzYuMTMyODEyNSwieSI6ODl9XQ==" marker-end="url(#mermaid-1_flowchart-v2-pointEnd)"></path><path d="M504.873,181.298L516.932,185.249C528.991,189.199,553.109,197.099,570.843,201.05C588.578,205,599.93,205,605.605,205L611.281,205" id="L_B_D_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_B_D_0" data-points="W3sieCI6NTA0Ljg3MzQ3MzY5NzExMTcsInkiOjE4MS4yOTg0MDEzMDI4ODgzfSx7IngiOjU3Ny4yMjY1NjI1LCJ5IjoyMDV9LHsieCI6NjE1LjI4MTI1LCJ5IjoyMDV9XQ==" marker-end="url(#mermaid-1_flowchart-v2-pointEnd)"></path><path d="M875.281,205L879.448,205C883.615,205,891.948,205,899.615,205C907.281,205,914.281,205,917.781,205L921.281,205" id="L_D_E_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_D_E_0" data-points="W3sieCI6ODc1LjI4MTI1LCJ5IjoyMDV9LHsieCI6OTAwLjI4MTI1LCJ5IjoyMDV9LHsieCI6OTI1LjI4MTI1LCJ5IjoyMDV9XQ==" marker-end="url(#mermaid-1_flowchart-v2-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" data-id="L_A_B_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(577.2265625, 89)"><g class="label" data-id="L_B_C_0" transform="translate(-10.2265625, -12)"><foreignObject width="20.453125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>No</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(577.2265625, 205)"><g class="label" data-id="L_B_D_0" transform="translate(-13.0546875, -12)"><foreignObject width="26.109375" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>Yes</p></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_D_E_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default" id="flowchart-A-0" transform="translate(109.5859375, 147)"><rect class="basic label-container" style="" x="-101.5859375" y="-27" width="203.171875" height="54"></rect><g class="label" style="" transform="translate(-71.5859375, -12)"><rect></rect><foreignObject width="143.171875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Child DNA Position i</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-B-1" transform="translate(400.171875, 147)"><polygon points="139,0 278,-139 139,-278 0,-139" class="label-container" transform="translate(-138.5, 139)"></polygon><g class="label" style="" transform="translate(-100, -24)"><rect></rect><foreignObject width="200" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;"><span class="nodeLabel"><p>Does child[i] match p1[i] or p2[i]?</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-C-3" transform="translate(745.28125, 89)"><rect class="basic label-container" style="" x="-109.1484375" y="-27" width="218.296875" height="54"></rect><g class="label" style="" transform="translate(-79.1484375, -12)"><rect></rect><foreignObject width="158.296875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Parent pair impossible</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-D-5" transform="translate(745.28125, 205)"><rect class="basic label-container" style="" x="-130" y="-39" width="260" height="78"></rect><g class="label" style="" transform="translate(-100, -24)"><rect></rect><foreignObject width="200" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;"><span class="nodeLabel"><p>Record (i, child[i]) → (p1, p2)</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-E-7" transform="translate(1034.890625, 205)"><rect class="basic label-container" style="" x="-109.609375" y="-27" width="219.21875" height="54"></rect><g class="label" style="" transform="translate(-79.609375, -12)"><rect></rect><foreignObject width="159.21875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Continue to next index</p></span></div></foreignObject></g></g></g></g></g></svg>
<p>A parent pair that survives every index becomes a globally valid possibility for that child.</p>
<hr>
<h2>Merging Possibilities for All Parent Pairs</h2>
<p>For a given potential child, I gather possibilities across <em>all possible parent pairs</em>:</p>
<pre><code class="language-python">def _build_parent_possibilities(di, child_num):
    result = {}
    child_seq = di[child_num]
    for num1, p1 in di.items():
        for num2, p2 in di.items():
            if num2 &#x3C;= num1:
                continue
            if child_num in (num1, num2):
                continue

            possibility_tree = _possibility_tree(num1, num2, p1, p2, child_seq)

            for k, v in possibility_tree.items():
                if k not in result:
                    result[k] = set()
                result[k].add(v)
    return result
</code></pre>
<p>The final structure looks like:</p>
<pre><code>(index, symbol) → {all parent pairs that could have produced that symbol at that index}
</code></pre>
<p>This gives a clean and flexible way to reason about each child.</p>
<hr>
<h2>Intersecting Parent Possibilities to Find the True Parents</h2>
<p>The key insight is that a real child must have exactly one parent pair that works for <strong>every</strong> DNA position. Which means:</p>
<ul>
<li>For position 0, gather all valid parent pairs</li>
<li>For position 1, gather all valid parent pairs</li>
<li>Intersect them</li>
<li>Continue for all positions</li>
</ul>
<p>If at any point the set becomes empty, the sequence isn’t a child at all.</p>
<p>This is the function that performs this deduction:</p>
<pre><code class="language-python">def get_child_parents(child_num, child_seq):
    parent_trees = _build_parent_possibilities(di, child_num)

    result = set()

    for i, c in enumerate(child_seq):
        possible_parents = parent_trees.get((i, c))
        if not possible_parents:
            return None
        if i == 0:
            result = possible_parents
        else:
            result = result.intersection(possible_parents)
        
        if len(result) == 0:
            return None
    
    return list(result)[0]
</code></pre>
<p>Here is the conceptual flow:</p>
<svg id="mermaid-2" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="flowchart" style="max-width: 811.015625px;" viewBox="0 0 811.015625 326" role="graphics-document document" aria-roledescription="flowchart-v2"><style>#mermaid-2{font-family:arial,sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-2 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-2 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-2 .error-icon{fill:#552222;}#mermaid-2 .error-text{fill:#552222;stroke:#552222;}#mermaid-2 .edge-thickness-normal{stroke-width:1px;}#mermaid-2 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-2 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-2 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-2 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-2 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-2 .marker{fill:#333333;stroke:#333333;}#mermaid-2 .marker.cross{stroke:#333333;}#mermaid-2 svg{font-family:arial,sans-serif;font-size:16px;}#mermaid-2 p{margin:0;}#mermaid-2 .label{font-family:arial,sans-serif;color:#333;}#mermaid-2 .cluster-label text{fill:#333;}#mermaid-2 .cluster-label span{color:#333;}#mermaid-2 .cluster-label span p{background-color:transparent;}#mermaid-2 .label text,#mermaid-2 span{fill:#333;color:#333;}#mermaid-2 .node rect,#mermaid-2 .node circle,#mermaid-2 .node ellipse,#mermaid-2 .node polygon,#mermaid-2 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-2 .rough-node .label text,#mermaid-2 .node .label text,#mermaid-2 .image-shape .label,#mermaid-2 .icon-shape .label{text-anchor:middle;}#mermaid-2 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-2 .rough-node .label,#mermaid-2 .node .label,#mermaid-2 .image-shape .label,#mermaid-2 .icon-shape .label{text-align:center;}#mermaid-2 .node.clickable{cursor:pointer;}#mermaid-2 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mermaid-2 .arrowheadPath{fill:#333333;}#mermaid-2 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-2 .flowchart-link{stroke:#333333;fill:none;}#mermaid-2 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-2 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mermaid-2 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-2 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-2 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-2 .cluster text{fill:#333;}#mermaid-2 .cluster span{color:#333;}#mermaid-2 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-2 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-2 rect.text{fill:none;stroke-width:0;}#mermaid-2 .icon-shape,#mermaid-2 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-2 .icon-shape p,#mermaid-2 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mermaid-2 .icon-shape rect,#mermaid-2 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-2 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-2 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-2 :root{--mermaid-font-family:arial,sans-serif;}</style><g><marker id="mermaid-2_flowchart-v2-pointEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-2_flowchart-v2-pointStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="4.5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-2_flowchart-v2-circleEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-2_flowchart-v2-circleStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-2_flowchart-v2-crossEnd" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-2_flowchart-v2-crossStart" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path d="M123.836,62L123.836,66.167C123.836,70.333,123.836,78.667,160.012,89.512C196.189,100.357,268.542,113.714,304.718,120.393L340.895,127.072" id="L_A_I_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_A_I_0" data-points="W3sieCI6MTIzLjgzNTkzNzUsInkiOjYyfSx7IngiOjEyMy44MzU5Mzc1LCJ5Ijo4N30seyJ4IjozNDQuODI4MTI1LCJ5IjoxMjcuNzk3ODAzMjk1MDU3NH1d" marker-end="url(#mermaid-2_flowchart-v2-pointEnd)"></path><path d="M405.508,62L405.508,66.167C405.508,70.333,405.508,78.667,405.508,86.333C405.508,94,405.508,101,405.508,104.5L405.508,108" id="L_B_I_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_B_I_0" data-points="W3sieCI6NDA1LjUwNzgxMjUsInkiOjYyfSx7IngiOjQwNS41MDc4MTI1LCJ5Ijo4N30seyJ4Ijo0MDUuNTA3ODEyNSwieSI6MTEyfV0=" marker-end="url(#mermaid-2_flowchart-v2-pointEnd)"></path><path d="M687.18,62L687.18,66.167C687.18,70.333,687.18,78.667,651.003,89.512C614.827,100.357,542.474,113.714,506.297,120.393L470.121,127.072" id="L_C_I_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_C_I_0" data-points="W3sieCI6Njg3LjE3OTY4NzUsInkiOjYyfSx7IngiOjY4Ny4xNzk2ODc1LCJ5Ijo4N30seyJ4Ijo0NjYuMTg3NSwieSI6MTI3Ljc5NzgwMzI5NTA1NzR9XQ==" marker-end="url(#mermaid-2_flowchart-v2-pointEnd)"></path><path d="M344.828,165.058L330.103,171.382C315.378,177.706,285.927,190.353,271.202,202.176C256.477,214,256.477,225,256.477,230.5L256.477,236" id="L_I_X_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_I_X_0" data-points="W3sieCI6MzQ0LjgyODEyNSwieSI6MTY1LjA1ODI5MzE0MzIxNjYyfSx7IngiOjI1Ni40NzY1NjI1LCJ5IjoyMDN9LHsieCI6MjU2LjQ3NjU2MjUsInkiOjI0MH1d" marker-end="url(#mermaid-2_flowchart-v2-pointEnd)"></path><path d="M466.188,165.058L480.913,171.382C495.638,177.706,525.089,190.353,539.814,204.176C554.539,218,554.539,233,554.539,240.5L554.539,248" id="L_I_Y_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_I_Y_0" data-points="W3sieCI6NDY2LjE4NzUsInkiOjE2NS4wNTgyOTMxNDMyMTY2Mn0seyJ4Ijo1NTQuNTM5MDYyNSwieSI6MjAzfSx7IngiOjU1NC41MzkwNjI1LCJ5IjoyNTJ9XQ==" marker-end="url(#mermaid-2_flowchart-v2-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" data-id="L_A_I_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_B_I_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_C_I_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(256.4765625, 203)"><g class="label" data-id="L_I_X_0" transform="translate(-21.7890625, -12)"><foreignObject width="43.578125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>empty</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(554.5390625, 203)"><g class="label" data-id="L_I_Y_0" transform="translate(-50.703125, -12)"><foreignObject width="101.40625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>one remaining</p></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default" id="flowchart-A-0" transform="translate(123.8359375, 35)"><rect class="basic label-container" style="" x="-115.8359375" y="-27" width="231.671875" height="54"></rect><g class="label" style="" transform="translate(-85.8359375, -12)"><rect></rect><foreignObject width="171.671875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Candidates at position 0</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-I-1" transform="translate(405.5078125, 139)"><rect class="basic label-container" style="" x="-60.6796875" y="-27" width="121.359375" height="54"></rect><g class="label" style="" transform="translate(-30.6796875, -12)"><rect></rect><foreignObject width="61.359375" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Intersect</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-B-2" transform="translate(405.5078125, 35)"><rect class="basic label-container" style="" x="-115.8359375" y="-27" width="231.671875" height="54"></rect><g class="label" style="" transform="translate(-85.8359375, -12)"><rect></rect><foreignObject width="171.671875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Candidates at position 1</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-C-4" transform="translate(687.1796875, 35)"><rect class="basic label-container" style="" x="-115.8359375" y="-27" width="231.671875" height="54"></rect><g class="label" style="" transform="translate(-85.8359375, -12)"><rect></rect><foreignObject width="171.671875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Candidates at position 2</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-X-7" transform="translate(256.4765625, 279)"><rect class="basic label-container" style="" x="-130" y="-39" width="260" height="78"></rect><g class="label" style="" transform="translate(-100, -24)"><rect></rect><foreignObject width="200" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;"><span class="nodeLabel"><p>Not a child → must be a parent</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-Y-9" transform="translate(554.5390625, 279)"><rect class="basic label-container" style="" x="-118.0625" y="-27" width="236.125" height="54"></rect><g class="label" style="" transform="translate(-88.0625, -12)"><rect></rect><foreignObject width="176.125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Unique parent pair found</p></span></div></foreignObject></g></g></g></g></g></svg>
<p>This step was my favourite part of the entire quest because it produces unambiguous answers using a simple, deterministic structure. No brute force. No guessing.</p>
<hr>
<h2>Finding All Children and Their Parents</h2>
<p>Once I had a reliable way to determine parenthood, identifying all children became simple:</p>
<pre><code class="language-python">def get_children_parents(di):
    result = {}
    for child_num, child_seq in di.items():
        parents = get_child_parents(child_num, child_seq)
        if parents is not None:
            result[child_num] = parents
    return result
</code></pre>
<p>If a node has parents, it’s a child. If not, it’s a parent.</p>
<hr>
<h2>Computing Similarity Scores (Part I and II)</h2>
<p>The puzzle defines a similarity score between a child and its two parents as:</p>
<pre><code>matches_with_parent1 * matches_with_parent2
</code></pre>
<p>My implementation follows the puzzle’s definition directly:</p>
<pre><code class="language-python">def get_similarity(child, parents, di):
    same_chars = {}
    for parent in parents:
        for parent_c, child_c in zip(di[parent], di[child]):
            if child_c == parent_c:
                same_chars[parent] = same_chars.get(parent, 0) + 1
    
    return math.prod(same_chars.values())
</code></pre>
<p>With parent–child mappings computed earlier, Part II simply sums all similarity scores.</p>
<hr>
<h2>Constructing Family Trees (Part III)</h2>
<p>Once every child knows its parents, we can flip the mapping:</p>
<pre><code class="language-python">def _flip_children_parents(children_parents):
    result = {}
    for child, (p1, p2) in children_parents.items():
        if p1 not in result:
            result[p1] = set()
        if p2 not in result:
            result[p2] = set()
        
        result[p1].add(child)
        result[p2].add(child)
    
    return result
</code></pre>
<p>This gives the reverse lookup:<br>
<code>parent → children</code>.</p>
<p>Then families can be found through graph traversal. Each family is a connected component:</p>
<pre><code class="language-python">def _get_full_tree(parent, children_parents, parents_children):
    queue = [parent]
    result = set()

    while queue:
        curr = queue.pop()
        result.add(curr)
        children = list(parents_children.get(curr, set()))
        
        for child in children:
            parents = children_parents.get(child)
            if parents is not None:
                for parent in parents:
                    if parent not in result:
                        queue.append(parent)

        queue.extend(children)

    return result
</code></pre>
<p>A family looks like this:</p>
<svg id="mermaid-3" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="flowchart" style="max-width: 461.625px;" viewBox="0 0 461.625 174" role="graphics-document document" aria-roledescription="flowchart-v2"><style>#mermaid-3{font-family:arial,sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-3 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-3 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-3 .error-icon{fill:#552222;}#mermaid-3 .error-text{fill:#552222;stroke:#552222;}#mermaid-3 .edge-thickness-normal{stroke-width:1px;}#mermaid-3 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-3 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-3 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-3 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-3 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-3 .marker{fill:#333333;stroke:#333333;}#mermaid-3 .marker.cross{stroke:#333333;}#mermaid-3 svg{font-family:arial,sans-serif;font-size:16px;}#mermaid-3 p{margin:0;}#mermaid-3 .label{font-family:arial,sans-serif;color:#333;}#mermaid-3 .cluster-label text{fill:#333;}#mermaid-3 .cluster-label span{color:#333;}#mermaid-3 .cluster-label span p{background-color:transparent;}#mermaid-3 .label text,#mermaid-3 span{fill:#333;color:#333;}#mermaid-3 .node rect,#mermaid-3 .node circle,#mermaid-3 .node ellipse,#mermaid-3 .node polygon,#mermaid-3 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-3 .rough-node .label text,#mermaid-3 .node .label text,#mermaid-3 .image-shape .label,#mermaid-3 .icon-shape .label{text-anchor:middle;}#mermaid-3 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-3 .rough-node .label,#mermaid-3 .node .label,#mermaid-3 .image-shape .label,#mermaid-3 .icon-shape .label{text-align:center;}#mermaid-3 .node.clickable{cursor:pointer;}#mermaid-3 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mermaid-3 .arrowheadPath{fill:#333333;}#mermaid-3 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-3 .flowchart-link{stroke:#333333;fill:none;}#mermaid-3 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-3 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mermaid-3 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-3 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-3 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-3 .cluster text{fill:#333;}#mermaid-3 .cluster span{color:#333;}#mermaid-3 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-3 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-3 rect.text{fill:none;stroke-width:0;}#mermaid-3 .icon-shape,#mermaid-3 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-3 .icon-shape p,#mermaid-3 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mermaid-3 .icon-shape rect,#mermaid-3 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-3 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-3 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-3 :root{--mermaid-font-family:arial,sans-serif;}</style><g><marker id="mermaid-3_flowchart-v2-pointEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-3_flowchart-v2-pointStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="4.5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-3_flowchart-v2-circleEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-3_flowchart-v2-circleStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-3_flowchart-v2-crossEnd" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-3_flowchart-v2-crossStart" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path d="M300.266,62L300.266,66.167C300.266,70.333,300.266,78.667,304.528,86.561C308.79,94.456,317.314,101.911,321.576,105.639L325.838,109.367" id="L_6_3_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_6_3_0" data-points="W3sieCI6MzAwLjI2NTYyNSwieSI6NjJ9LHsieCI6MzAwLjI2NTYyNSwieSI6ODd9LHsieCI6MzI4Ljg0ODg1ODE3MzA3NjksInkiOjExMn1d" marker-end="url(#mermaid-3_flowchart-v2-pointEnd)"></path><path d="M419.172,62L419.172,66.167C419.172,70.333,419.172,78.667,414.91,86.561C410.648,94.456,402.124,101.911,397.862,105.639L393.599,109.367" id="L_7_3_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_7_3_0" data-points="W3sieCI6NDE5LjE3MTg3NSwieSI6NjJ9LHsieCI6NDE5LjE3MTg3NSwieSI6ODd9LHsieCI6MzkwLjU4ODY0MTgyNjkyMzEsInkiOjExMn1d" marker-end="url(#mermaid-3_flowchart-v2-pointEnd)"></path><path d="M42.069,62L40.466,66.167C38.863,70.333,35.658,78.667,34.731,86.345C33.804,94.024,35.155,101.048,35.83,104.56L36.505,108.072" id="L_2_1_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_2_1_0" data-points="W3sieCI6NDIuMDY4NTA5NjE1Mzg0NjEsInkiOjYyfSx7IngiOjMyLjQ1MzEyNSwieSI6ODd9LHsieCI6MzcuMjYwODE3MzA3NjkyMzEsInkiOjExMn1d" marker-end="url(#mermaid-3_flowchart-v2-pointEnd)"></path><path d="M136.906,60.795L131.073,65.163C125.24,69.53,113.573,78.265,103.478,86.36C93.382,94.456,84.858,101.911,80.596,105.639L76.334,109.367" id="L_5_1_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_5_1_0" data-points="W3sieCI6MTM2LjkwNjI1LCJ5Ijo2MC43OTUyNzU1OTA1NTExODV9LHsieCI6MTAxLjkwNjI1LCJ5Ijo4N30seyJ4Ijo3My4zMjMwMTY4MjY5MjMwOCwieSI6MTEyfV0=" marker-end="url(#mermaid-3_flowchart-v2-pointEnd)"></path><path d="M86.906,60.795L92.74,65.163C98.573,69.53,110.24,78.265,120.335,86.36C130.43,94.456,138.955,101.911,143.217,105.639L147.479,109.367" id="L_2_4_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_2_4_0" data-points="W3sieCI6ODYuOTA2MjUsInkiOjYwLjc5NTI3NTU5MDU1MTE4NX0seyJ4IjoxMjEuOTA2MjUsInkiOjg3fSx7IngiOjE1MC40ODk0ODMxNzMwNzY5MywieSI6MTEyfV0=" marker-end="url(#mermaid-3_flowchart-v2-pointEnd)"></path><path d="M202.229,62L206.993,66.167C211.757,70.333,221.285,78.667,222.545,86.517C223.806,94.367,216.8,101.734,213.297,105.418L209.794,109.101" id="L_5_4_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_5_4_0" data-points="W3sieCI6MjAyLjIyOTI2NjgyNjkyMzA3LCJ5Ijo2Mn0seyJ4IjoyMzAuODEyNSwieSI6ODd9LHsieCI6MjA3LjAzNjk1OTEzNDYxNTQsInkiOjExMn1d" marker-end="url(#mermaid-3_flowchart-v2-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" data-id="L_6_3_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_7_3_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_2_1_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_5_1_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_2_4_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_5_4_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default" id="flowchart-1-5" transform="translate(42.453125, 139)"><rect class="basic label-container" style="" x="-34.453125" y="-27" width="68.90625" height="54"></rect><g class="label" style="" transform="translate(-4.453125, -12)"><rect></rect><foreignObject width="8.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>1</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-2-4" transform="translate(52.453125, 35)"><rect class="basic label-container" style="" x="-34.453125" y="-27" width="68.90625" height="54"></rect><g class="label" style="" transform="translate(-4.453125, -12)"><rect></rect><foreignObject width="8.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>2</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-3-1" transform="translate(359.71875, 139)"><rect class="basic label-container" style="" x="-34.453125" y="-27" width="68.90625" height="54"></rect><g class="label" style="" transform="translate(-4.453125, -12)"><rect></rect><foreignObject width="8.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>3</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-4-9" transform="translate(181.359375, 139)"><rect class="basic label-container" style="" x="-34.453125" y="-27" width="68.90625" height="54"></rect><g class="label" style="" transform="translate(-4.453125, -12)"><rect></rect><foreignObject width="8.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>4</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-5-6" transform="translate(171.359375, 35)"><rect class="basic label-container" style="" x="-34.453125" y="-27" width="68.90625" height="54"></rect><g class="label" style="" transform="translate(-4.453125, -12)"><rect></rect><foreignObject width="8.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>5</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-6-0" transform="translate(300.265625, 35)"><rect class="basic label-container" style="" x="-34.453125" y="-27" width="68.90625" height="54"></rect><g class="label" style="" transform="translate(-4.453125, -12)"><rect></rect><foreignObject width="8.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>6</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-7-2" transform="translate(419.171875, 35)"><rect class="basic label-container" style="" x="-34.453125" y="-27" width="68.90625" height="54"></rect><g class="label" style="" transform="translate(-4.453125, -12)"><rect></rect><foreignObject width="8.90625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>7</p></span></div></foreignObject></g></g></g></g></g></svg>
<p>Everything connected belongs to the same lineage, even if the tree twists between generations or loops across siblings.</p>
<p>Finally, I computed all families and picked the largest:</p>
<pre><code class="language-python">def part3(di):
    family_trees = get_family_trees(di)
    sortedd = sorted(family_trees, key=lambda x: len(x), reverse=True)
    largest_tree = sortedd[0]
    return sum(largest_tree)
</code></pre>
<hr>
<h2>Closing Thoughts on Quest 9</h2>
<p>This challenge was a great mix of pattern recognition, set logic, and graph traversal. The possibility tree approach turned out to be especially clean and satisfying. From that structure, everything else followed naturally, including detecting children, computing similarity scores, and building entire family lineages.</p>
<p>It’s the kind of puzzle that looks complicated on the surface but becomes elegant once you see the right abstraction.</p>
<h1>Quest 10 – Dragon Chess and the Explosion of Possibility</h1>
<p>Quest 10 was one of the most surprising challenges in Everybody Codes 2025. It starts out as a simple movement puzzle with a dragon and some sheep, and quietly turns into a huge combinatorial search, especially in Part III. Somehow a tiny board hides trillions of different games.</p>
<hr>
<h2>Part I – Four Move Reachability</h2>
<p>The first part is a warm up: place the dragon on the board, scatter some sheep around it, and count how many sheep are within four knight moves.</p>
<p>I used a simple bounded breadth first search. The only thing you really need is a way to generate knight moves from a given square:</p>
<pre><code class="language-python">def knight_moves(curr):
    cx, cy = curr
    moves = [(1, 2), (2, 1)]
    flips = [(1, 1), (-1, 1), (1, -1), (-1, -1)]

    for mx, my in moves:
        for fx, fy in flips:
            nx = cx + (mx * fx)
            ny = cy + (my * fy)
            yield (nx, ny)
</code></pre>
<p>From there I start at the dragon, explore up to depth 4, collect all visited squares, and intersect that set with the sheep positions. That gives the answer for Part I.</p>
<p>A high level view of this is just expanding layers around the starting square:</p>
<svg id="mermaid-4" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="flowchart" style="max-width: 1962.62109375px;" viewBox="0 0 1962.62109375 378" role="graphics-document document" aria-roledescription="flowchart-v2"><style>#mermaid-4{font-family:arial,sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-4 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-4 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-4 .error-icon{fill:#552222;}#mermaid-4 .error-text{fill:#552222;stroke:#552222;}#mermaid-4 .edge-thickness-normal{stroke-width:1px;}#mermaid-4 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-4 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-4 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-4 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-4 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-4 .marker{fill:#333333;stroke:#333333;}#mermaid-4 .marker.cross{stroke:#333333;}#mermaid-4 svg{font-family:arial,sans-serif;font-size:16px;}#mermaid-4 p{margin:0;}#mermaid-4 .label{font-family:arial,sans-serif;color:#333;}#mermaid-4 .cluster-label text{fill:#333;}#mermaid-4 .cluster-label span{color:#333;}#mermaid-4 .cluster-label span p{background-color:transparent;}#mermaid-4 .label text,#mermaid-4 span{fill:#333;color:#333;}#mermaid-4 .node rect,#mermaid-4 .node circle,#mermaid-4 .node ellipse,#mermaid-4 .node polygon,#mermaid-4 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-4 .rough-node .label text,#mermaid-4 .node .label text,#mermaid-4 .image-shape .label,#mermaid-4 .icon-shape .label{text-anchor:middle;}#mermaid-4 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-4 .rough-node .label,#mermaid-4 .node .label,#mermaid-4 .image-shape .label,#mermaid-4 .icon-shape .label{text-align:center;}#mermaid-4 .node.clickable{cursor:pointer;}#mermaid-4 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mermaid-4 .arrowheadPath{fill:#333333;}#mermaid-4 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-4 .flowchart-link{stroke:#333333;fill:none;}#mermaid-4 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-4 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mermaid-4 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-4 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-4 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-4 .cluster text{fill:#333;}#mermaid-4 .cluster span{color:#333;}#mermaid-4 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-4 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-4 rect.text{fill:none;stroke-width:0;}#mermaid-4 .icon-shape,#mermaid-4 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-4 .icon-shape p,#mermaid-4 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mermaid-4 .icon-shape rect,#mermaid-4 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-4 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-4 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-4 :root{--mermaid-font-family:arial,sans-serif;}</style><g><marker id="mermaid-4_flowchart-v2-pointEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-4_flowchart-v2-pointStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="4.5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-4_flowchart-v2-circleEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-4_flowchart-v2-circleStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-4_flowchart-v2-crossEnd" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-4_flowchart-v2-crossStart" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"><g class="cluster" id="L2" data-look="classic"><rect style="" x="8" y="266" width="1600.421875" height="104"></rect><g class="cluster-label" transform="translate(757.078125, 266)"><foreignObject width="102.265625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>2 moves away</p></span></div></foreignObject></g></g><g class="cluster" id="L1" data-look="classic"><rect style="" x="25.39453125" y="8" width="1929.2265625" height="208"></rect><g class="cluster-label" transform="translate(942.875, 8)"><foreignObject width="94.265625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>1 move away</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path d="M1419.816,63.468L1222.316,71.557C1024.815,79.645,629.814,95.823,432.313,107.411C234.813,119,234.813,126,234.813,129.5L234.813,133" id="L_D_A1_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_D_A1_0" data-points="W3sieCI6MTQxOS44MTY0MDYyNSwieSI6NjMuNDY4MDYzODMyMzQwMTJ9LHsieCI6MjM0LjgxMjUsInkiOjExMn0seyJ4IjoyMzQuODEyNSwieSI6MTM3fV0=" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path><path d="M1419.816,65.86L1308.701,73.55C1197.586,81.24,975.355,96.62,864.24,107.81C753.125,119,753.125,126,753.125,129.5L753.125,133" id="L_D_A2_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_D_A2_0" data-points="W3sieCI6MTQxOS44MTY0MDYyNSwieSI6NjUuODYwNDExNDM1MzQ0NzZ9LHsieCI6NzUzLjEyNSwieSI6MTEyfSx7IngiOjc1My4xMjUsInkiOjEzN31d" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path><path d="M1419.816,79.425L1396.148,84.854C1372.48,90.283,1325.145,101.142,1301.477,110.071C1277.809,119,1277.809,126,1277.809,129.5L1277.809,133" id="L_D_A3_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_D_A3_0" data-points="W3sieCI6MTQxOS44MTY0MDYyNSwieSI6NzkuNDI0NzMxMTgyNzk1N30seyJ4IjoxMjc3LjgwODU5Mzc1LCJ5IjoxMTJ9LHsieCI6MTI3Ny44MDg1OTM3NSwieSI6MTM3fV0=" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path><path d="M1449.912,87L1441.488,91.167C1433.065,95.333,1416.218,103.667,1407.795,111.333C1399.371,119,1399.371,126,1399.371,129.5L1399.371,133" id="L_D_A4_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_D_A4_0" data-points="W3sieCI6MTQ0OS45MTE5NTkxMzQ2MTU1LCJ5Ijo4N30seyJ4IjoxMzk5LjM3MTA5Mzc1LCJ5IjoxMTJ9LHsieCI6MTM5OS4zNzEwOTM3NSwieSI6MTM3fV0=" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path><path d="M1512.8,87L1514.081,91.167C1515.363,95.333,1517.925,103.667,1519.207,111.333C1520.488,119,1520.488,126,1520.488,129.5L1520.488,133" id="L_D_A5_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_D_A5_0" data-points="W3sieCI6MTUxMi43OTk3Mjk1NjczMDc2LCJ5Ijo4N30seyJ4IjoxNTIwLjQ4ODI4MTI1LCJ5IjoxMTJ9LHsieCI6MTUyMC40ODgyODEyNSwieSI6MTM3fV0=" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path><path d="M1575.225,87L1586.14,91.167C1597.055,95.333,1618.885,103.667,1629.8,111.333C1640.715,119,1640.715,126,1640.715,129.5L1640.715,133" id="L_D_A6_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_D_A6_0" data-points="W3sieCI6MTU3NS4yMjUwNjAwOTYxNTM4LCJ5Ijo4N30seyJ4IjoxNjQwLjcxNDg0Mzc1LCJ5IjoxMTJ9LHsieCI6MTY0MC43MTQ4NDM3NSwieSI6MTM3fV0=" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path><path d="M1589.176,77.111L1617.952,82.926C1646.728,88.741,1704.28,100.37,1733.056,109.685C1761.832,119,1761.832,126,1761.832,129.5L1761.832,133" id="L_D_A7_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_D_A7_0" data-points="W3sieCI6MTU4OS4xNzU3ODEyNSwieSI6NzcuMTExMjY2MjgwMDkzNX0seyJ4IjoxNzYxLjgzMjAzMTI1LCJ5IjoxMTJ9LHsieCI6MTc2MS44MzIwMzEyNSwieSI6MTM3fV0=" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path><path d="M1589.176,71.608L1638.286,78.34C1687.397,85.072,1785.618,98.536,1834.729,108.768C1883.84,119,1883.84,126,1883.84,129.5L1883.84,133" id="L_D_A8_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_D_A8_0" data-points="W3sieCI6MTU4OS4xNzU3ODEyNSwieSI6NzEuNjA3NzkzMDYzNjc5MDV9LHsieCI6MTg4My44Mzk4NDM3NSwieSI6MTEyfSx7IngiOjE4ODMuODM5ODQzNzUsInkiOjEzN31d" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path><path d="M199.477,176.087L180.029,182.739C160.581,189.391,121.685,202.696,102.237,213.514C82.789,224.333,82.789,232.667,82.789,241C82.789,249.333,82.789,257.667,82.789,265.333C82.789,273,82.789,280,82.789,283.5L82.789,287" id="L_A1_B1_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_A1_B1_0" data-points="W3sieCI6MTk5LjQ3NjU2MjUsInkiOjE3Ni4wODY3NDY0OTI2MjU1fSx7IngiOjgyLjc4OTA2MjUsInkiOjIxNn0seyJ4Ijo4Mi43ODkwNjI1LCJ5IjoyNDF9LHsieCI6ODIuNzg5MDYyNSwieSI6MjY2fSx7IngiOjgyLjc4OTA2MjUsInkiOjI5MX1d" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path><path d="M223.158,191L221.36,195.167C219.561,199.333,215.964,207.667,214.166,216C212.367,224.333,212.367,232.667,212.367,241C212.367,249.333,212.367,257.667,212.367,265.333C212.367,273,212.367,280,212.367,283.5L212.367,287" id="L_A1_B2_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_A1_B2_0" data-points="W3sieCI6MjIzLjE1ODIwMzEyNSwieSI6MTkxfSx7IngiOjIxMi4zNjcxODc1LCJ5IjoyMTZ9LHsieCI6MjEyLjM2NzE4NzUsInkiOjI0MX0seyJ4IjoyMTIuMzY3MTg3NSwieSI6MjY2fSx7IngiOjIxMi4zNjcxODc1LCJ5IjoyOTF9XQ==" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path><path d="M270.148,181.151L282.115,186.959C294.081,192.768,318.013,204.384,329.979,214.359C341.945,224.333,341.945,232.667,341.945,241C341.945,249.333,341.945,257.667,341.945,265.333C341.945,273,341.945,280,341.945,283.5L341.945,287" id="L_A1_B3_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_A1_B3_0" data-points="W3sieCI6MjcwLjE0ODQzNzUsInkiOjE4MS4xNTEzMTYyNjkyMzM1OH0seyJ4IjozNDEuOTQ1MzEyNSwieSI6MjE2fSx7IngiOjM0MS45NDUzMTI1LCJ5IjoyNDF9LHsieCI6MzQxLjk0NTMxMjUsInkiOjI2Nn0seyJ4IjozNDEuOTQ1MzEyNSwieSI6MjkxfV0=" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path><path d="M270.148,171.763L303.711,179.135C337.273,186.508,404.398,201.254,437.961,212.794C471.523,224.333,471.523,232.667,471.523,241C471.523,249.333,471.523,257.667,471.523,265.333C471.523,273,471.523,280,471.523,283.5L471.523,287" id="L_A1_B4_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_A1_B4_0" data-points="W3sieCI6MjcwLjE0ODQzNzUsInkiOjE3MS43NjI1MDA0MTI1NTQ4Nn0seyJ4Ijo0NzEuNTIzNDM3NSwieSI6MjE2fSx7IngiOjQ3MS41MjM0Mzc1LCJ5IjoyNDF9LHsieCI6NDcxLjUyMzQzNzUsInkiOjI2Nn0seyJ4Ijo0NzEuNTIzNDM3NSwieSI6MjkxfV0=" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path><path d="M717.789,176.087L698.341,182.739C678.893,189.391,639.997,202.696,620.549,213.514C601.102,224.333,601.102,232.667,601.102,241C601.102,249.333,601.102,257.667,601.102,265.333C601.102,273,601.102,280,601.102,283.5L601.102,287" id="L_A2_B5_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_A2_B5_0" data-points="W3sieCI6NzE3Ljc4OTA2MjUsInkiOjE3Ni4wODY3NDY0OTI2MjU1fSx7IngiOjYwMS4xMDE1NjI1LCJ5IjoyMTZ9LHsieCI6NjAxLjEwMTU2MjUsInkiOjI0MX0seyJ4Ijo2MDEuMTAxNTYyNSwieSI6MjY2fSx7IngiOjYwMS4xMDE1NjI1LCJ5IjoyOTF9XQ==" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path><path d="M741.471,191L739.672,195.167C737.874,199.333,734.277,207.667,732.478,216C730.68,224.333,730.68,232.667,730.68,241C730.68,249.333,730.68,257.667,730.68,265.333C730.68,273,730.68,280,730.68,283.5L730.68,287" id="L_A2_B6_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_A2_B6_0" data-points="W3sieCI6NzQxLjQ3MDcwMzEyNSwieSI6MTkxfSx7IngiOjczMC42Nzk2ODc1LCJ5IjoyMTZ9LHsieCI6NzMwLjY3OTY4NzUsInkiOjI0MX0seyJ4Ijo3MzAuNjc5Njg3NSwieSI6MjY2fSx7IngiOjczMC42Nzk2ODc1LCJ5IjoyOTF9XQ==" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path><path d="M788.461,181.151L800.427,186.959C812.393,192.768,836.326,204.384,848.292,214.359C860.258,224.333,860.258,232.667,860.258,241C860.258,249.333,860.258,257.667,860.258,265.333C860.258,273,860.258,280,860.258,283.5L860.258,287" id="L_A2_B7_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_A2_B7_0" data-points="W3sieCI6Nzg4LjQ2MDkzNzUsInkiOjE4MS4xNTEzMTYyNjkyMzM1OH0seyJ4Ijo4NjAuMjU3ODEyNSwieSI6MjE2fSx7IngiOjg2MC4yNTc4MTI1LCJ5IjoyNDF9LHsieCI6ODYwLjI1NzgxMjUsInkiOjI2Nn0seyJ4Ijo4NjAuMjU3ODEyNSwieSI6MjkxfV0=" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path><path d="M788.461,171.763L822.023,179.135C855.586,186.508,922.711,201.254,956.273,212.794C989.836,224.333,989.836,232.667,989.836,241C989.836,249.333,989.836,257.667,989.836,265.333C989.836,273,989.836,280,989.836,283.5L989.836,287" id="L_A2_B8_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_A2_B8_0" data-points="W3sieCI6Nzg4LjQ2MDkzNzUsInkiOjE3MS43NjI1MDA0MTI1NTQ4Nn0seyJ4Ijo5ODkuODM1OTM3NSwieSI6MjE2fSx7IngiOjk4OS44MzU5Mzc1LCJ5IjoyNDF9LHsieCI6OTg5LjgzNTkzNzUsInkiOjI2Nn0seyJ4Ijo5ODkuODM1OTM3NSwieSI6MjkxfV0=" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path><path d="M1242.027,175.747L1221.592,182.456C1201.156,189.165,1160.285,202.582,1139.85,213.458C1119.414,224.333,1119.414,232.667,1119.414,241C1119.414,249.333,1119.414,257.667,1119.414,265.333C1119.414,273,1119.414,280,1119.414,283.5L1119.414,287" id="L_A3_B9_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_A3_B9_0" data-points="W3sieCI6MTI0Mi4wMjczNDM3NSwieSI6MTc1Ljc0Njc3NTUwNjE3Nzd9LHsieCI6MTExOS40MTQwNjI1LCJ5IjoyMTZ9LHsieCI6MTExOS40MTQwNjI1LCJ5IjoyNDF9LHsieCI6MTExOS40MTQwNjI1LCJ5IjoyNjZ9LHsieCI6MTExOS40MTQwNjI1LCJ5IjoyOTF9XQ==" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path><path d="M1265.154,191L1263.202,195.167C1261.249,199.333,1257.343,207.667,1255.39,216C1253.438,224.333,1253.438,232.667,1253.438,241C1253.438,249.333,1253.438,257.667,1253.438,265.333C1253.438,273,1253.438,280,1253.438,283.5L1253.438,287" id="L_A3_B10_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_A3_B10_0" data-points="W3sieCI6MTI2NS4xNTQzNzE5OTUxOTI0LCJ5IjoxOTF9LHsieCI6MTI1My40Mzc1LCJ5IjoyMTZ9LHsieCI6MTI1My40Mzc1LCJ5IjoyNDF9LHsieCI6MTI1My40Mzc1LCJ5IjoyNjZ9LHsieCI6MTI1My40Mzc1LCJ5IjoyOTF9XQ==" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path><path d="M1313.59,180.393L1326.544,186.327C1339.497,192.262,1365.405,204.131,1378.359,214.232C1391.313,224.333,1391.313,232.667,1391.313,241C1391.313,249.333,1391.313,257.667,1391.313,265.333C1391.313,273,1391.313,280,1391.313,283.5L1391.313,287" id="L_A3_B11_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_A3_B11_0" data-points="W3sieCI6MTMxMy41ODk4NDM3NSwieSI6MTgwLjM5MjYwNzYzMzI3MjUyfSx7IngiOjEzOTEuMzEyNSwieSI6MjE2fSx7IngiOjEzOTEuMzEyNSwieSI6MjQxfSx7IngiOjEzOTEuMzEyNSwieSI6MjY2fSx7IngiOjEzOTEuMzEyNSwieSI6MjkxfV0=" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path><path d="M1313.59,171.402L1349.523,178.835C1385.456,186.268,1457.322,201.134,1493.255,212.734C1529.188,224.333,1529.188,232.667,1529.188,241C1529.188,249.333,1529.188,257.667,1529.188,265.333C1529.188,273,1529.188,280,1529.188,283.5L1529.188,287" id="L_A3_B12_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_A3_B12_0" data-points="W3sieCI6MTMxMy41ODk4NDM3NSwieSI6MTcxLjQwMTY3NTEzNTU4MDMyfSx7IngiOjE1MjkuMTg3NSwieSI6MjE2fSx7IngiOjE1MjkuMTg3NSwieSI6MjQxfSx7IngiOjE1MjkuMTg3NSwieSI6MjY2fSx7IngiOjE1MjkuMTg3NSwieSI6MjkxfV0=" marker-end="url(#mermaid-4_flowchart-v2-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" data-id="L_D_A1_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_D_A2_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_D_A3_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_D_A4_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_D_A5_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_D_A6_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_D_A7_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_D_A8_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_A1_B1_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_A1_B2_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_A1_B3_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_A1_B4_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_A2_B5_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_A2_B6_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_A2_B7_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_A2_B8_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_A3_B9_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_A3_B10_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_A3_B11_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_A3_B12_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default" id="flowchart-D-0" transform="translate(1504.49609375, 60)"><rect class="basic label-container" style="" x="-84.6796875" y="-27" width="169.359375" height="54"></rect><g class="label" style="" transform="translate(-54.6796875, -12)"><rect></rect><foreignObject width="109.359375" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Start (0 moves)</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-A1-2" transform="translate(234.8125, 164)"><rect class="basic label-container" style="" x="-35.3359375" y="-27" width="70.671875" height="54"></rect><g class="label" style="" transform="translate(-5.3359375, -12)"><rect></rect><foreignObject width="10.671875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>A</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-A2-4" transform="translate(753.125, 164)"><rect class="basic label-container" style="" x="-35.3359375" y="-27" width="70.671875" height="54"></rect><g class="label" style="" transform="translate(-5.3359375, -12)"><rect></rect><foreignObject width="10.671875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>B</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-A3-6" transform="translate(1277.80859375, 164)"><rect class="basic label-container" style="" x="-35.78125" y="-27" width="71.5625" height="54"></rect><g class="label" style="" transform="translate(-5.78125, -12)"><rect></rect><foreignObject width="11.5625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>C</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-A4-8" transform="translate(1399.37109375, 164)"><rect class="basic label-container" style="" x="-35.78125" y="-27" width="71.5625" height="54"></rect><g class="label" style="" transform="translate(-5.78125, -12)"><rect></rect><foreignObject width="11.5625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>D</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-A5-10" transform="translate(1520.48828125, 164)"><rect class="basic label-container" style="" x="-35.3359375" y="-27" width="70.671875" height="54"></rect><g class="label" style="" transform="translate(-5.3359375, -12)"><rect></rect><foreignObject width="10.671875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>E</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-A6-12" transform="translate(1640.71484375, 164)"><rect class="basic label-container" style="" x="-34.890625" y="-27" width="69.78125" height="54"></rect><g class="label" style="" transform="translate(-4.890625, -12)"><rect></rect><foreignObject width="9.78125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>F</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-A7-14" transform="translate(1761.83203125, 164)"><rect class="basic label-container" style="" x="-36.2265625" y="-27" width="72.453125" height="54"></rect><g class="label" style="" transform="translate(-6.2265625, -12)"><rect></rect><foreignObject width="12.453125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>G</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-A8-16" transform="translate(1883.83984375, 164)"><rect class="basic label-container" style="" x="-35.78125" y="-27" width="71.5625" height="54"></rect><g class="label" style="" transform="translate(-5.78125, -12)"><rect></rect><foreignObject width="11.5625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>H</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-B1-18" transform="translate(82.7890625, 318)"><rect class="basic label-container" style="" x="-39.7890625" y="-27" width="79.578125" height="54"></rect><g class="label" style="" transform="translate(-9.7890625, -12)"><rect></rect><foreignObject width="19.578125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>B1</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-B2-20" transform="translate(212.3671875, 318)"><rect class="basic label-container" style="" x="-39.7890625" y="-27" width="79.578125" height="54"></rect><g class="label" style="" transform="translate(-9.7890625, -12)"><rect></rect><foreignObject width="19.578125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>B2</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-B3-22" transform="translate(341.9453125, 318)"><rect class="basic label-container" style="" x="-39.7890625" y="-27" width="79.578125" height="54"></rect><g class="label" style="" transform="translate(-9.7890625, -12)"><rect></rect><foreignObject width="19.578125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>B3</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-B4-24" transform="translate(471.5234375, 318)"><rect class="basic label-container" style="" x="-39.7890625" y="-27" width="79.578125" height="54"></rect><g class="label" style="" transform="translate(-9.7890625, -12)"><rect></rect><foreignObject width="19.578125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>B4</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-B5-26" transform="translate(601.1015625, 318)"><rect class="basic label-container" style="" x="-39.7890625" y="-27" width="79.578125" height="54"></rect><g class="label" style="" transform="translate(-9.7890625, -12)"><rect></rect><foreignObject width="19.578125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>B5</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-B6-28" transform="translate(730.6796875, 318)"><rect class="basic label-container" style="" x="-39.7890625" y="-27" width="79.578125" height="54"></rect><g class="label" style="" transform="translate(-9.7890625, -12)"><rect></rect><foreignObject width="19.578125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>B6</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-B7-30" transform="translate(860.2578125, 318)"><rect class="basic label-container" style="" x="-39.7890625" y="-27" width="79.578125" height="54"></rect><g class="label" style="" transform="translate(-9.7890625, -12)"><rect></rect><foreignObject width="19.578125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>B7</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-B8-32" transform="translate(989.8359375, 318)"><rect class="basic label-container" style="" x="-39.7890625" y="-27" width="79.578125" height="54"></rect><g class="label" style="" transform="translate(-9.7890625, -12)"><rect></rect><foreignObject width="19.578125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>B8</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-B9-34" transform="translate(1119.4140625, 318)"><rect class="basic label-container" style="" x="-39.7890625" y="-27" width="79.578125" height="54"></rect><g class="label" style="" transform="translate(-9.7890625, -12)"><rect></rect><foreignObject width="19.578125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>B9</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-B10-36" transform="translate(1253.4375, 318)"><rect class="basic label-container" style="" x="-44.234375" y="-27" width="88.46875" height="54"></rect><g class="label" style="" transform="translate(-14.234375, -12)"><rect></rect><foreignObject width="28.46875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>B10</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-B11-38" transform="translate(1391.3125, 318)"><rect class="basic label-container" style="" x="-43.640625" y="-27" width="87.28125" height="54"></rect><g class="label" style="" transform="translate(-13.640625, -12)"><rect></rect><foreignObject width="27.28125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>B11</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-B12-40" transform="translate(1529.1875, 318)"><rect class="basic label-container" style="" x="-44.234375" y="-27" width="88.46875" height="54"></rect><g class="label" style="" transform="translate(-14.234375, -12)"><rect></rect><foreignObject width="28.46875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>B12</p></span></div></foreignObject></g></g></g></g></g></svg>
<p>Every node here is a board square; after 4 layers you just check which of them hold sheep.</p>
<hr>
<h2>Part II – Falling Sheep</h2>
<p>Part II adds gravity. Each round:</p>
<ol>
<li>The dragon moves like a knight.</li>
<li>All sheep move one square down.</li>
<li>If a sheep lands on the dragon’s square and it is not a hideout, it gets eaten.</li>
</ol>
<p>The question is: across all possible dragon move choices over 20 rounds, how many sheep can be eaten at least once?</p>
<p>To avoid simulating sheep on the fly, I precompute where every original sheep would be after <code>t</code> steps:</p>
<pre><code class="language-python">def generate_sheep_positions(sheep, board_size, n):
    boards = {}
    for i in range(n+1):
        di = {}
        for x, y in sheep:
            nx, ny = (x, y + i)
            if ny >= board_size[1]:
                continue
            di[(nx, ny)] = (x, y)
        boards[i] = di
    return boards
</code></pre>
<p>That gives me a dictionary:</p>
<ul>
<li>key: time step <code>t</code></li>
<li>value: a mapping from current position to original sheep position</li>
</ul>
<p>Then I run a BFS over <code>(dragon_position, t)</code> and at each state I check:</p>
<ul>
<li>sheep standing on the dragon square before they move</li>
<li>sheep landing on the dragon square after they move</li>
</ul>
<p>If any of those are on non protected squares, I add the original sheep to a <code>captured_sheep</code> set so it is only counted once, no matter how many different paths eat it. This works fine for Part II.</p>
<hr>
<h2>Part III – Every Possible Game</h2>
<p>In the final part the rules shift again and it becomes a full game search:</p>
<ul>
<li>Sheep move first.</li>
<li>Only one sheep moves each sheep turn.</li>
<li>Sheep move downwards and avoid stepping onto the dragon unless there is a hideout.</li>
<li>If at least one sheep can move, exactly one of them must move; otherwise the sheep skip.</li>
<li>The dragon must always move.</li>
<li>The game ends only when every sheep has been eaten.</li>
<li>We are asked to count every distinct sequence of moves that leads to that outcome.</li>
</ul>
<p>My first instinct was to keep using a queue and explore the game tree. That failed pretty quickly. The reason is that the same board state can be reached through many different move orders. A pure BFS keeps re exploring those states over and over.</p>
<p>A simplified picture of the problem looks like this:</p>
<svg id="mermaid-5" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="flowchart" style="max-width: 474.765625px;" viewBox="0 0 474.765625 174" role="graphics-document document" aria-roledescription="flowchart-v2"><style>#mermaid-5{font-family:arial,sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-5 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-5 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-5 .error-icon{fill:#552222;}#mermaid-5 .error-text{fill:#552222;stroke:#552222;}#mermaid-5 .edge-thickness-normal{stroke-width:1px;}#mermaid-5 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-5 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-5 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-5 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-5 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-5 .marker{fill:#333333;stroke:#333333;}#mermaid-5 .marker.cross{stroke:#333333;}#mermaid-5 svg{font-family:arial,sans-serif;font-size:16px;}#mermaid-5 p{margin:0;}#mermaid-5 .label{font-family:arial,sans-serif;color:#333;}#mermaid-5 .cluster-label text{fill:#333;}#mermaid-5 .cluster-label span{color:#333;}#mermaid-5 .cluster-label span p{background-color:transparent;}#mermaid-5 .label text,#mermaid-5 span{fill:#333;color:#333;}#mermaid-5 .node rect,#mermaid-5 .node circle,#mermaid-5 .node ellipse,#mermaid-5 .node polygon,#mermaid-5 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-5 .rough-node .label text,#mermaid-5 .node .label text,#mermaid-5 .image-shape .label,#mermaid-5 .icon-shape .label{text-anchor:middle;}#mermaid-5 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-5 .rough-node .label,#mermaid-5 .node .label,#mermaid-5 .image-shape .label,#mermaid-5 .icon-shape .label{text-align:center;}#mermaid-5 .node.clickable{cursor:pointer;}#mermaid-5 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mermaid-5 .arrowheadPath{fill:#333333;}#mermaid-5 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-5 .flowchart-link{stroke:#333333;fill:none;}#mermaid-5 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-5 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mermaid-5 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-5 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-5 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-5 .cluster text{fill:#333;}#mermaid-5 .cluster span{color:#333;}#mermaid-5 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-5 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-5 rect.text{fill:none;stroke-width:0;}#mermaid-5 .icon-shape,#mermaid-5 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-5 .icon-shape p,#mermaid-5 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mermaid-5 .icon-shape rect,#mermaid-5 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-5 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-5 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-5 :root{--mermaid-font-family:arial,sans-serif;}</style><g><marker id="mermaid-5_flowchart-v2-pointEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-5_flowchart-v2-pointStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="4.5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-5_flowchart-v2-circleEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-5_flowchart-v2-circleStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-5_flowchart-v2-crossEnd" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-5_flowchart-v2-crossStart" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path d="M121.95,60L129.279,55.833C136.607,51.667,151.265,43.333,162.167,39.167C173.07,35,180.219,35,183.793,35L187.367,35" id="L_S0_A_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_S0_A_0" data-points="W3sieCI6MTIxLjk1MDI3MDQzMjY5MjMsInkiOjYwfSx7IngiOjE2NS45MjE4NzUsInkiOjM1fSx7IngiOjE5MS4zNjcxODc1LCJ5IjozNX1d" marker-end="url(#mermaid-5_flowchart-v2-pointEnd)"></path><path d="M121.95,114L129.279,118.167C136.607,122.333,151.265,130.667,162.093,134.833C172.922,139,179.922,139,183.422,139L186.922,139" id="L_S0_B_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_S0_B_0" data-points="W3sieCI6MTIxLjk1MDI3MDQzMjY5MjMsInkiOjExNH0seyJ4IjoxNjUuOTIxODc1LCJ5IjoxMzl9LHsieCI6MTkwLjkyMTg3NSwieSI6MTM5fV0=" marker-end="url(#mermaid-5_flowchart-v2-pointEnd)"></path><path d="M302.961,35L307.202,35C311.443,35,319.924,35,330.148,38.809C340.371,42.617,352.336,50.235,358.319,54.043L364.301,57.852" id="L_A_C_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_A_C_0" data-points="W3sieCI6MzAyLjk2MDkzNzUsInkiOjM1fSx7IngiOjMyOC40MDYyNSwieSI6MzV9LHsieCI6MzY3LjY3NTMzMDUyODg0NjEzLCJ5Ijo2MH1d" marker-end="url(#mermaid-5_flowchart-v2-pointEnd)"></path><path d="M303.406,139L307.573,139C311.74,139,320.073,139,330.222,135.191C340.371,131.383,352.336,123.765,358.319,119.957L364.301,116.148" id="L_B_C_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_B_C_0" data-points="W3sieCI6MzAzLjQwNjI1LCJ5IjoxMzl9LHsieCI6MzI4LjQwNjI1LCJ5IjoxMzl9LHsieCI6MzY3LjY3NTMzMDUyODg0NjEzLCJ5IjoxMTR9XQ==" marker-end="url(#mermaid-5_flowchart-v2-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" data-id="L_S0_A_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_S0_B_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_A_C_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_B_C_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default" id="flowchart-S0-0" transform="translate(74.4609375, 87)"><rect class="basic label-container" style="" x="-66.4609375" y="-27" width="132.921875" height="54"></rect><g class="label" style="" transform="translate(-36.4609375, -12)"><rect></rect><foreignObject width="72.921875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Start state</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-A-1" transform="translate(247.1640625, 35)"><rect class="basic label-container" style="" x="-55.796875" y="-27" width="111.59375" height="54"></rect><g class="label" style="" transform="translate(-25.796875, -12)"><rect></rect><foreignObject width="51.59375" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>State A</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-B-3" transform="translate(247.1640625, 139)"><rect class="basic label-container" style="" x="-56.2421875" y="-27" width="112.484375" height="54"></rect><g class="label" style="" transform="translate(-26.2421875, -12)"><rect></rect><foreignObject width="52.484375" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>State B</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-C-5" transform="translate(410.0859375, 87)"><rect class="basic label-container" style="" x="-56.6796875" y="-27" width="113.359375" height="54"></rect><g class="label" style="" transform="translate(-26.6796875, -12)"><rect></rect><foreignObject width="53.359375" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>State C</p></span></div></foreignObject></g></g></g></g></g></svg>
<p><code>State C</code> is the same configuration reached from two different histories.<br>
A queue-based approach treats both paths separately, which means:</p>
<ul>
<li>repeated exploration</li>
<li>exponential blowup</li>
<li>and eventually running out of time or memory</li>
</ul>
<hr>
<h2>The Key Realisation – State, Not History</h2>
<p>The crucial insight was:</p>
<blockquote>
<p>Once you know the current board state (dragon position and the set of sheep positions), the number of winning continuations from that state is fixed. It does not matter how you got there.</p>
</blockquote>
<p>So instead of thinking in terms of move histories, I rewrote the solution as a function over states.</p>
<h3>Sheep move generation</h3>
<p>I started with a helper that generates all possible results of a single sheep turn:</p>
<pre><code class="language-python">def all_single_sheep_moves(sheep, dragon, protected_squares):
    result = []
    for sx, sy in sheep:
        nx, ny = sx, sy + 1
        if ((nx, ny) == dragon) and ((nx, ny) not in protected_squares):
            continue
        new_sheep_state = sheep.difference({(sx, sy)}).union({(nx, ny)})
        result.append(new_sheep_state)

    if len(result) > 0:
        return result

    return [sheep]  # no sheep can move, so the state stays as it is
</code></pre>
<p>If at least one sheep can move, I generate all resulting sheep states. If none can move, I return the current set in a single element list, which represents “sheep skip their turn”.</p>
<p>Then there is a simple helper to detect escapes:</p>
<pre><code class="language-python">def any_escaped_sheep(sheep, board_size):
    _, Y = board_size
    return any([sy >= Y for _, sy in sheep])
</code></pre>
<h3>Recursion with memoisation</h3>
<p>The heart of the solution is a recursive function <code>count_sequences</code>, which returns the number of ways to finish the game from a given state:</p>
<pre><code class="language-python">from functools import lru_cache

def part3(dragon, sheep, protected_squares, board_size):
    PROTECTED_SQUARES = protected_squares
    BOARD_SIZE = board_size
    
    @lru_cache(maxsize=None)
    def count_sequences(dragon, sheep):
        if len(sheep) == 0:
            return 1  # one complete valid game

        total = 0
        sheep_board_states = all_single_sheep_moves(sheep, dragon, PROTECTED_SQUARES)

        for sheep_state in sheep_board_states:
            if any_escaped_sheep(sheep_state, BOARD_SIZE):
                continue

            for square in knight_moves(dragon):
                if not is_in_bounds(square, BOARD_SIZE):
                    continue

                if (square in sheep_state) and (square not in protected_squares):
                    total += count_sequences(square, frozenset(sheep_state.difference({square})))
                else:
                    total += count_sequences(square, frozenset(sheep_state))
        
        return total
    
    return count_sequences(dragon, frozenset(sheep))
</code></pre>
<p>Two important details:</p>
<ul>
<li>Sheep sets are turned into <code>frozenset</code> so the state is hashable.</li>
<li><code>@lru_cache(maxsize=None)</code> means each distinct <code>(dragon_position, sheep_set)</code> pair is evaluated once. If the recursion hits that state again via a different move order, it just reuses the stored result.</li>
</ul>
<p>Conceptually, the recursion builds a directed acyclic graph (DAG) of states, not a full tree:</p>
<svg id="mermaid-6" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="flowchart" style="max-width: 287.40625px;" viewBox="0 0 287.40625 382" role="graphics-document document" aria-roledescription="flowchart-v2"><style>#mermaid-6{font-family:arial,sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-6 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-6 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-6 .error-icon{fill:#552222;}#mermaid-6 .error-text{fill:#552222;stroke:#552222;}#mermaid-6 .edge-thickness-normal{stroke-width:1px;}#mermaid-6 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-6 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-6 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-6 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-6 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-6 .marker{fill:#333333;stroke:#333333;}#mermaid-6 .marker.cross{stroke:#333333;}#mermaid-6 svg{font-family:arial,sans-serif;font-size:16px;}#mermaid-6 p{margin:0;}#mermaid-6 .label{font-family:arial,sans-serif;color:#333;}#mermaid-6 .cluster-label text{fill:#333;}#mermaid-6 .cluster-label span{color:#333;}#mermaid-6 .cluster-label span p{background-color:transparent;}#mermaid-6 .label text,#mermaid-6 span{fill:#333;color:#333;}#mermaid-6 .node rect,#mermaid-6 .node circle,#mermaid-6 .node ellipse,#mermaid-6 .node polygon,#mermaid-6 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-6 .rough-node .label text,#mermaid-6 .node .label text,#mermaid-6 .image-shape .label,#mermaid-6 .icon-shape .label{text-anchor:middle;}#mermaid-6 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-6 .rough-node .label,#mermaid-6 .node .label,#mermaid-6 .image-shape .label,#mermaid-6 .icon-shape .label{text-align:center;}#mermaid-6 .node.clickable{cursor:pointer;}#mermaid-6 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mermaid-6 .arrowheadPath{fill:#333333;}#mermaid-6 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-6 .flowchart-link{stroke:#333333;fill:none;}#mermaid-6 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-6 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mermaid-6 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-6 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-6 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-6 .cluster text{fill:#333;}#mermaid-6 .cluster span{color:#333;}#mermaid-6 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-6 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-6 rect.text{fill:none;stroke-width:0;}#mermaid-6 .icon-shape,#mermaid-6 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-6 .icon-shape p,#mermaid-6 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mermaid-6 .icon-shape rect,#mermaid-6 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-6 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-6 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-6 :root{--mermaid-font-family:arial,sans-serif;}</style><g><marker id="mermaid-6_flowchart-v2-pointEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-6_flowchart-v2-pointStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="4.5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-6_flowchart-v2-circleEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-6_flowchart-v2-circleStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-6_flowchart-v2-crossEnd" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-6_flowchart-v2-crossStart" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path d="M101.982,62L95.544,66.167C89.105,70.333,76.228,78.667,69.79,86.333C63.352,94,63.352,101,63.352,104.5L63.352,108" id="L_S0_S1_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_S0_S1_0" data-points="W3sieCI6MTAxLjk4MjEyMTM5NDIzMDc3LCJ5Ijo2Mn0seyJ4Ijo2My4zNTE1NjI1LCJ5Ijo4N30seyJ4Ijo2My4zNTE1NjI1LCJ5IjoxMTJ9XQ==" marker-end="url(#mermaid-6_flowchart-v2-pointEnd)"></path><path d="M185.424,62L191.863,66.167C198.301,70.333,211.178,78.667,217.616,86.333C224.055,94,224.055,101,224.055,104.5L224.055,108" id="L_S0_S2_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_S0_S2_0" data-points="W3sieCI6MTg1LjQyNDEyODYwNTc2OTIzLCJ5Ijo2Mn0seyJ4IjoyMjQuMDU0Njg3NSwieSI6ODd9LHsieCI6MjI0LjA1NDY4NzUsInkiOjExMn1d" marker-end="url(#mermaid-6_flowchart-v2-pointEnd)"></path><path d="M63.352,166L63.352,170.167C63.352,174.333,63.352,182.667,69.23,190.638C75.109,198.609,86.867,206.218,92.745,210.022L98.624,213.827" id="L_S1_S3_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_S1_S3_0" data-points="W3sieCI6NjMuMzUxNTYyNSwieSI6MTY2fSx7IngiOjYzLjM1MTU2MjUsInkiOjE5MX0seyJ4IjoxMDEuOTgyMTIxMzk0MjMwNzcsInkiOjIxNn1d" marker-end="url(#mermaid-6_flowchart-v2-pointEnd)"></path><path d="M224.055,166L224.055,170.167C224.055,174.333,224.055,182.667,218.176,190.638C212.297,198.609,200.54,206.218,194.661,210.022L188.782,213.827" id="L_S2_S3_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_S2_S3_0" data-points="W3sieCI6MjI0LjA1NDY4NzUsInkiOjE2Nn0seyJ4IjoyMjQuMDU0Njg3NSwieSI6MTkxfSx7IngiOjE4NS40MjQxMjg2MDU3NjkyMywieSI6MjE2fV0=" marker-end="url(#mermaid-6_flowchart-v2-pointEnd)"></path><path d="M143.703,270L143.703,274.167C143.703,278.333,143.703,286.667,143.703,294.333C143.703,302,143.703,309,143.703,312.5L143.703,316" id="L_S3_S4_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_S3_S4_0" data-points="W3sieCI6MTQzLjcwMzEyNSwieSI6MjcwfSx7IngiOjE0My43MDMxMjUsInkiOjI5NX0seyJ4IjoxNDMuNzAzMTI1LCJ5IjozMjB9XQ==" marker-end="url(#mermaid-6_flowchart-v2-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" data-id="L_S0_S1_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_S0_S2_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_S1_S3_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_S2_S3_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_S3_S4_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default" id="flowchart-S0-0" transform="translate(143.703125, 35)"><rect class="basic label-container" style="" x="-66.4609375" y="-27" width="132.921875" height="54"></rect><g class="label" style="" transform="translate(-36.4609375, -12)"><rect></rect><foreignObject width="72.921875" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Start state</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-S1-1" transform="translate(63.3515625, 139)"><rect class="basic label-container" style="" x="-55.3515625" y="-27" width="110.703125" height="54"></rect><g class="label" style="" transform="translate(-25.3515625, -12)"><rect></rect><foreignObject width="50.703125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>State 1</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-S2-3" transform="translate(224.0546875, 139)"><rect class="basic label-container" style="" x="-55.3515625" y="-27" width="110.703125" height="54"></rect><g class="label" style="" transform="translate(-25.3515625, -12)"><rect></rect><foreignObject width="50.703125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>State 2</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-S3-5" transform="translate(143.703125, 243)"><rect class="basic label-container" style="" x="-55.3515625" y="-27" width="110.703125" height="54"></rect><g class="label" style="" transform="translate(-25.3515625, -12)"><rect></rect><foreignObject width="50.703125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>State 3</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-S4-9" transform="translate(143.703125, 347)"><rect class="basic label-container" style="" x="-85.15625" y="-27" width="170.3125" height="54"></rect><g class="label" style="" transform="translate(-55.15625, -12)"><rect></rect><foreignObject width="110.3125" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>All sheep eaten</p></span></div></foreignObject></g></g></g></g></g></svg>
<p>The same state (like <code>State 3</code>) can have multiple parents, but it is computed once and reused everywhere.</p>
<hr>
<h2>Performance Notes – How the Solver Survived 32 Trillion Games</h2>
<p>After finishing the implementation I profiled the code for Part III.<br>
The headline numbers are fun:</p>
<pre><code>41075406 function calls (40573146 primitive calls) in 12.501 seconds
</code></pre>
<p>So about <strong>41 million function calls</strong> in roughly <strong>12.5 seconds</strong>, to count<br>
<strong>32,177,131,563,721</strong> distinct winning games.</p>
<p>Some of the key lines from the profiler:</p>
<ul>
<li><code>15,036,633</code> calls to <code>knight_moves</code></li>
<li><code>13,365,896</code> calls to <code>is_in_bounds</code></li>
<li><code>2,587,715</code> calls to <code>frozenset.difference</code></li>
<li><code>2,019,035</code> calls to <code>any_escaped_sheep</code></li>
<li><code>502,261</code> calls to <code>count_sequences</code> (the recursive core)</li>
<li><code>502,247</code> calls to <code>all_single_sheep_moves</code></li>
</ul>
<p>The most important one is:</p>
<pre><code class="language-text">502261/1  count_sequences
</code></pre>
<p>That means there were 502,261 total calls, but most hit the LRU cache and returned instantly. So the number of <em>unique</em> states explored was around half a million, even though the number of possible games is in the tens of trillions.</p>
<p>You can picture the difference like this:</p>
<svg id="mermaid-7" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="flowchart" style="max-width: 983.859375px;" viewBox="0 0 983.859375 94" role="graphics-document document" aria-roledescription="flowchart-v2"><style>#mermaid-7{font-family:arial,sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-7 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-7 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-7 .error-icon{fill:#552222;}#mermaid-7 .error-text{fill:#552222;stroke:#552222;}#mermaid-7 .edge-thickness-normal{stroke-width:1px;}#mermaid-7 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-7 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-7 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-7 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-7 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-7 .marker{fill:#333333;stroke:#333333;}#mermaid-7 .marker.cross{stroke:#333333;}#mermaid-7 svg{font-family:arial,sans-serif;font-size:16px;}#mermaid-7 p{margin:0;}#mermaid-7 .label{font-family:arial,sans-serif;color:#333;}#mermaid-7 .cluster-label text{fill:#333;}#mermaid-7 .cluster-label span{color:#333;}#mermaid-7 .cluster-label span p{background-color:transparent;}#mermaid-7 .label text,#mermaid-7 span{fill:#333;color:#333;}#mermaid-7 .node rect,#mermaid-7 .node circle,#mermaid-7 .node ellipse,#mermaid-7 .node polygon,#mermaid-7 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-7 .rough-node .label text,#mermaid-7 .node .label text,#mermaid-7 .image-shape .label,#mermaid-7 .icon-shape .label{text-anchor:middle;}#mermaid-7 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-7 .rough-node .label,#mermaid-7 .node .label,#mermaid-7 .image-shape .label,#mermaid-7 .icon-shape .label{text-align:center;}#mermaid-7 .node.clickable{cursor:pointer;}#mermaid-7 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mermaid-7 .arrowheadPath{fill:#333333;}#mermaid-7 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-7 .flowchart-link{stroke:#333333;fill:none;}#mermaid-7 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-7 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mermaid-7 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-7 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-7 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-7 .cluster text{fill:#333;}#mermaid-7 .cluster span{color:#333;}#mermaid-7 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-7 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-7 rect.text{fill:none;stroke-width:0;}#mermaid-7 .icon-shape,#mermaid-7 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-7 .icon-shape p,#mermaid-7 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mermaid-7 .icon-shape rect,#mermaid-7 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-7 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-7 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-7 :root{--mermaid-font-family:arial,sans-serif;}</style><g><marker id="mermaid-7_flowchart-v2-pointEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-7_flowchart-v2-pointStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="4.5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-7_flowchart-v2-circleEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-7_flowchart-v2-circleStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-7_flowchart-v2-crossEnd" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-7_flowchart-v2-crossStart" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path d="M268,47L280.32,47C292.641,47,317.281,47,341.255,47C365.229,47,388.536,47,400.19,47L411.844,47" id="L_T_D_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_T_D_0" data-points="W3sieCI6MjY4LCJ5Ijo0N30seyJ4IjozNDEuOTIxODc1LCJ5Ijo0N30seyJ4Ijo0MTUuODQzNzUsInkiOjQ3fV0=" marker-end="url(#mermaid-7_flowchart-v2-pointEnd)"></path><path d="M675.844,47L680.01,47C684.177,47,692.51,47,700.177,47C707.844,47,714.844,47,718.344,47L721.844,47" id="L_D_R_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_D_R_0" data-points="W3sieCI6Njc1Ljg0Mzc1LCJ5Ijo0N30seyJ4Ijo3MDAuODQzNzUsInkiOjQ3fSx7IngiOjcyNS44NDM3NSwieSI6NDd9XQ==" marker-end="url(#mermaid-7_flowchart-v2-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(341.921875, 47)"><g class="label" data-id="L_T_D_0" transform="translate(-48.921875, -12)"><foreignObject width="97.84375" height="24"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>collapsed into</p></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" data-id="L_D_R_0" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default" id="flowchart-T-0" transform="translate(138, 47)"><rect class="basic label-container" style="" x="-130" y="-39" width="260" height="78"></rect><g class="label" style="" transform="translate(-100, -24)"><rect></rect><foreignObject width="200" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;"><span class="nodeLabel"><p>Huge game tree (trillions of paths)</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-D-1" transform="translate(545.84375, 47)"><rect class="basic label-container" style="" x="-130" y="-39" width="260" height="78"></rect><g class="label" style="" transform="translate(-100, -24)"><rect></rect><foreignObject width="200" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;"><span class="nodeLabel"><p>Smaller DAG of ~500k states</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-R-3" transform="translate(850.8515625, 47)"><rect class="basic label-container" style="" x="-125.0078125" y="-27" width="250.015625" height="54"></rect><g class="label" style="" transform="translate(-95.0078125, -12)"><rect></rect><foreignObject width="190.015625" height="24"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Recursive DP with caching</p></span></div></foreignObject></g></g></g></g></g></svg>
<p>The memoisation effectively collapses the gigantic tree of histories into a much smaller DAG of positions.</p>
<hr>
<h2>Final Number and Takeaways</h2>
<p>The final answer for my input was:</p>
<p><code>32177131563721</code></p>
<p>which is:</p>
<p><strong>32,177,131,563,721 different sequences</strong><br>
in which the dragon eventually eats all the sheep.</p>
<p>For such a small board, that number is ridiculous in the best way. It really shows how quickly game trees grow and how important it is to think in terms of <strong>states</strong> and <strong>memoisation</strong>, not just brute force search.</p>
<p>What I liked most about this quest is that the core rules are simple, but the only practical way to solve it is to lean into a clean state representation and let recursion plus caching do the heavy lifting.</p>